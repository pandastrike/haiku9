"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.handler = void 0;

require("source-map-support/register");

var _errorResponse = _interopRequireDefault(require("./error-response"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// Generated by CoffeeScript 2.4.1
var handler;
exports.handler = handler;

exports.handler = handler = async function (event, context, callback) {
  var data, e, request, response;

  try {
    ({
      request,
      response
    } = event.Records[0].cf);
    data = {
      uri: request.uri,
      accept: request.headers["accept"][0].value,
      acceptEncoding: request.headers["accept-encoding"][0].value,
      status: response.status
    };
    console.log(data);

    if (data.status > 399) {
      if (data.accept === "text/html") {
        return callback(null, (await (0, _errorResponse.default)(request, response)));
      } else {
        response.status = "404";
        response.statusDescription = "404 Not Found";
        response.body = JSON.stringify({
          error: "Not Found"
        });
        return callback(null, response);
      }
    } else {
      return callback(null, response);
    }
  } catch (error) {
    e = error;
    console.log(e);
    return callback(null, response);
  }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9pbmRleC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOzs7OztBQURBLElBQUEsT0FBQTs7O0FBR0Esa0JBQUEsT0FBQSxHQUFVLGdCQUFBLEtBQUEsRUFBQSxPQUFBLEVBQUEsUUFBQSxFQUFBO0FBQ1IsTUFBQSxJQUFBLEVBQUEsQ0FBQSxFQUFBLE9BQUEsRUFBQSxRQUFBOztBQUFBLE1BQUE7QUFDRSxLQUFBO0FBQUEsTUFBQSxPQUFBO0FBQUEsTUFBQTtBQUFBLFFBQXNCLEtBQUssQ0FBQyxPQUFOLENBQWMsQ0FBZCxFQUF0QixFQUFBO0FBRUEsSUFBQSxJQUFBLEdBQ0U7QUFBQSxNQUFBLEdBQUEsRUFBSyxPQUFPLENBQVosR0FBQTtBQUNBLE1BQUEsTUFBQSxFQUFRLE9BQU8sQ0FBQyxPQUFSLENBQWdCLFFBQWhCLEVBQTBCLENBQTFCLEVBRFIsS0FBQTtBQUVBLE1BQUEsY0FBQSxFQUFnQixPQUFPLENBQUMsT0FBUixDQUFnQixpQkFBaEIsRUFBbUMsQ0FBbkMsRUFGaEIsS0FBQTtBQUdBLE1BQUEsTUFBQSxFQUFRLFFBQVEsQ0FBQztBQUhqQixLQURGO0FBTUEsSUFBQSxPQUFPLENBQVAsR0FBQSxDQUFBLElBQUE7O0FBRUEsUUFBRyxJQUFJLENBQUosTUFBQSxHQUFILEdBQUEsRUFBQTtBQUNFLFVBQUcsSUFBSSxDQUFKLE1BQUEsS0FBSCxXQUFBLEVBQUE7ZUFDRSxRQUFBLENBQUEsSUFBQSxHQUFlLE1BQU0sNEJBQUEsT0FBQSxFQUR2QixRQUN1QixDQUFyQixFO0FBREYsT0FBQSxNQUFBO0FBR0UsUUFBQSxRQUFRLENBQVIsTUFBQSxHQUFrQixLQUFsQjtBQUNBLFFBQUEsUUFBUSxDQUFSLGlCQUFBLEdBQTZCLGVBQTdCO0FBQ0EsUUFBQSxRQUFRLENBQVIsSUFBQSxHQUFnQixJQUFJLENBQUosU0FBQSxDQUFlO0FBQUEsVUFBQSxLQUFBLEVBQU87QUFBUCxTQUFmLENBQWhCO2VBQ0EsUUFBQSxDQUFBLElBQUEsRUFORixRQU1FLEM7QUFQSjtBQUFBLEtBQUEsTUFBQTthQVNFLFFBQUEsQ0FBQSxJQUFBLEVBVEYsUUFTRSxDO0FBcEJKO0FBQUEsR0FBQSxDQUFBLE9BQUEsS0FBQSxFQUFBO0FBc0JNLElBQUEsQ0FBQSxHQUFBLEtBQUE7QUFDSixJQUFBLE9BQU8sQ0FBUCxHQUFBLENBQUEsQ0FBQTtXQUNBLFFBQUEsQ0FBQSxJQUFBLEVBeEJGLFFBd0JFLEM7O0FBekJNLENBQVYiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXCJzb3VyY2UtbWFwLXN1cHBvcnQvcmVnaXN0ZXJcIlxuaW1wb3J0IGVycm9yUmVzcG9uc2UgZnJvbSBcIi4vZXJyb3ItcmVzcG9uc2VcIlxuXG5oYW5kbGVyID0gKGV2ZW50LCBjb250ZXh0LCBjYWxsYmFjaykgLT5cbiAgdHJ5XG4gICAge3JlcXVlc3QsIHJlc3BvbnNlfSA9IGV2ZW50LlJlY29yZHNbMF0uY2ZcblxuICAgIGRhdGEgPVxuICAgICAgdXJpOiByZXF1ZXN0LnVyaVxuICAgICAgYWNjZXB0OiByZXF1ZXN0LmhlYWRlcnNbXCJhY2NlcHRcIl1bMF0udmFsdWVcbiAgICAgIGFjY2VwdEVuY29kaW5nOiByZXF1ZXN0LmhlYWRlcnNbXCJhY2NlcHQtZW5jb2RpbmdcIl1bMF0udmFsdWVcbiAgICAgIHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzXG5cbiAgICBjb25zb2xlLmxvZyBkYXRhXG5cbiAgICBpZiBkYXRhLnN0YXR1cyA+IDM5OVxuICAgICAgaWYgZGF0YS5hY2NlcHQgPT0gXCJ0ZXh0L2h0bWxcIlxuICAgICAgICBjYWxsYmFjayBudWxsLCBhd2FpdCBlcnJvclJlc3BvbnNlIHJlcXVlc3QsIHJlc3BvbnNlXG4gICAgICBlbHNlXG4gICAgICAgIHJlc3BvbnNlLnN0YXR1cyA9IFwiNDA0XCJcbiAgICAgICAgcmVzcG9uc2Uuc3RhdHVzRGVzY3JpcHRpb24gPSBcIjQwNCBOb3QgRm91bmRcIlxuICAgICAgICByZXNwb25zZS5ib2R5ID0gSlNPTi5zdHJpbmdpZnkgZXJyb3I6IFwiTm90IEZvdW5kXCJcbiAgICAgICAgY2FsbGJhY2sgbnVsbCwgcmVzcG9uc2VcbiAgICBlbHNlXG4gICAgICBjYWxsYmFjayBudWxsLCByZXNwb25zZVxuXG4gIGNhdGNoIGVcbiAgICBjb25zb2xlLmxvZyBlXG4gICAgY2FsbGJhY2sgbnVsbCwgcmVzcG9uc2VcblxuZXhwb3J0IHtoYW5kbGVyfVxuIl0sInNvdXJjZVJvb3QiOiIuLiJ9
//# sourceURL=/Users/david/repos/haiku9/edge-lambdas/primary/origin-response/src/index.coffee